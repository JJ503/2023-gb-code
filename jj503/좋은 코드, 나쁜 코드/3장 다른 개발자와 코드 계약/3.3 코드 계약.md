## 3.3 코드 계약

### [용어 정리] 코드 계약

- **선결 조건** : 코드를 호출하기 전 사실이어야 하는 것
- **사후 조건** : 코드가 호출된 후 사실이어야 하는 것
- **불변 사항** : 코드가 호출되기 전과 후에 시스템 상태를 비교해 변경되지 않아야 하는 사항

<br>

### 1. 계약의 세부 조항

- **코드에서 계약을 정의할 때도 명확한 부분과 세부 조항이 있다**
- 코드 계약에서 조건을 명백하게 하는 것이 세부 조항을 사용하는 것보다 좋음
- 세부 조항은 항상 정확하다고 할 수 없음


1. **계약의 명확한 부분**
    - 함수와 클래스 이름 : 호출하는 쪽에서 이것을 모르면 코드를 사용할 수 없음
    - 인자 유형 : 호출하는 쪽에서 인자 유형을 잘못 사용하면 컴파일되지 않음
    - 반환 유형 : 호출하는 쪽에서 함수의 반환유형과 일치하지 않는 유형을 사용하면 컴파일되지 않음
    - 검사 예외 : 호출하는 코드가 예외를 처리하지 않으면 컴파일되지 않음


2. **세부 조항**
    - 주석문과 문서 : 실제 계약의 세부 조항에 대해 작성해 꼼곰하게 읽어봐야 함. 잘 읽지 않음
    - 비검사 예외 : 주석문에 나열되어 있다면 세부 조항임 (잊고 작성하지 않을 수도 있음)

<br>

### 2. 세부 조항에 너무 의존하지 말라

> 주석문과 문서의 형태로 된 세부 조항은 많은 사람이 간과하고 넘어가는 경우가 많기에, 코드 계약을 전달할 때 세부 조항을 사용하는 것은 신뢰할 만한 방법이 아니다

- **세부 조항 의존의 문제점**
    - 오용하기 쉬운 취약한 코드가 될 가능성이 크다
    - 예상과 다르게 동작하기 쉽다
    - 위 두 가지 이유로 고품질 코드 작성이 어려워진다


- **세부 조항을 제거하는 방법**
    - 잘못된 일을 하는 것을 처음부터 불가능하도록 발생 자체가 불가능하게 만드는 것이 좋음
    - 코드가 오용되거나 잘못 설정되었을 때 컴파일조차 되지 않도록 함 (데이터 유형을 통해)
    - 정적 팩토리 메서드를 사용해 초기화가 완전히 이루어진 인스턴스를 얻는 것만 가능하도록 함
    - 즉, 상태나 가변성이 클래스 외부로 노출되는 것을 없앤다
        - 상태와 가변성 : 객체를 만든 후 객체의 상태를 수정할 수 있다면 가변적이라고 함
    - 실패한 이유에 대한 오류 정보가 있으면 유용함
