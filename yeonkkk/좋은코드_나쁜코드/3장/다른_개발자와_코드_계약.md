# 3장. 다른 개발자와 코드 계약  
> 자신이 작성한 코드를 다른 개발자가 작업해야 하고, 반대로 다른 개발자가 작업한 코드를 자신이 작업해야 할 때도 있다.  

<br><br>

## 요약  
* 다른 개발자가 어떻게 코드를 해석하고 오용할 수 있을지 생각해보고, 이러한 가능성을 최소화하거나 **오용이 불가능하게 만드는 방식으로 코드를 작성**하는 것이 유용하다. 

* 코드를 작성할 때 일종의 **코드 계약**이 만들어진다. 
  > 계약에는 명백한 항목이나 세부 조항과 같은 내용이 포함될 수 있다.  

* 코드 계약의 세부 조항은 다른 개발자가 계약을 준수하도록 하기 위한 방법이지만 신뢰할만한 방법은 아니다. 
  > 보통 더 나은 접근법은 **명백한 항목으로 계약의 내용을 전달**하는 것이다.
  
* 일반적으로 **컴파일러를 사용하여 계약을 확인하는 것이 가장 신뢰할 수 있는 방법**이다. 
  > 이것이 가능하지 않을 때, **체크나 어서션**을 사용하여 실행 시간에 계약을 확인할 수 있다.  

<br><br>

## 1. 자신의 코드와 다른 개발자의 코드
> 다른 개발자들이 활발하게 코드를 변경하더라도 코드의 품질이 유지되려면 코드가 튼튼하고 사용하기 쉬워야 한다.  

코드를 작성할 때는 **1. 다른 개발자가 변경하거나 코드와 상호작용할 때 발생할 수 있는 문제는 없는지** **2. 발생한다면 그 문제를 어떻게 완화할 수 있을지를 이해하고 선제적으로 조치하는 것**을 고려해야 한다.  

* 코드 작성 시 고려할 3가지

  * 자신에게 명백하다고 해서 다른 사람에게도 명백한 것은 아니다.  
  
  * 다른 개발자는 무의식 중에 코드를 망가뜨릴 수 있다.  
  
  * 시간이 지남에 따라 자신의 코드를 기억하지 못한다.  

<br><br>

### 자신에게 분명하다고 다른 사람에게도 분명한 것은 아니다  
> 코드가 어떻게 사용되어야 하는지, 무엇을 하는지, 왜 그 일을 하고 있는지 설명하는 것이 유용하다.  
> 코드를 이해하기 쉽고 코드 자체로 설명이 되게 하는 것이 좋다.  


<br><br>

### 다른 개발자는 무의식 중에 코드를 망가뜨릴 수 있다  
> 작성한 코드는 독립적으로 존재하지 않는다(다른 코드에 의존한다).  
> 작성한 코드는 끊임 없이 변화하는 코드 위에 놓여 있다.  
> 작성한 코드를 기반으로 계속해서 변화하는 코드도 끊임없이 작성된다.  

다른 개발자의 코드 변경으로 코드가 작동하지 않거나 오용하는 결과가 발생되면 문제 해결 전까지 코드베이스에 병합되면 안된다.   
이를 위해 문제가 발생하면 코드 컴파일이 중지되거나 테스트가 실패하도록 만들 수 있다. 

<br><br>

### 시간이 지나면 자신의 코드를 기억하지 못한다  
> 배경지식이 거의 없거나 전혀 없는 사람에게도 자신의 코드가 이해하기 쉬워야 하고, 잘 작동하던 코드에 버그가 발생하는 것이 어려워야 한다.  
> 미래의 자신에게도 유익한 일이라는 것을 명심하자. 미래의 자신은 본질적으로 다른 개발자라고 간주해야한다.  

<br><br>

## 2. 작성한 코드의 사용법을 다른 사람들은 어떻게 아는가?  
다른 개발자가 코드를 사용할 때 **1. 어떻게 사용하는지, 2. 그 코드가 무슨 일을 하는지** 파악해야 한다.  

* 다른 개발자가 작성한 코드를 읽을 때 고려할 사항
  * 여러 가지 상황에서 어떤 함수를 호출해야하는지
  * 클래스가 무엇을 나타내는지 그리고 언제 사용되어야 하는지
  * 어떤 값을 인수로 사용해야 하는지
  * 코드가 수행하는 동작이 무엇인지
  * 어떤 값을 반환하는지

<br>

* 작성된 코드 사용 방법을 알아내기 위해 시도할 수 있는 것들
  * **함수, 클래스, 열거형 등의 이름을 살펴본다.**  
  * **함수와 생성자의 매개변수 유형 또는 반환값의 유형 같은 데이터 유형을 살펴본다.**  
  * **함수/클래스 수준의 문서나 주석문을 읽어본다.**  
  * 직접 만나 묻거나 채팅/이메일을 통해 문의한다.  
  * 함수와 클래스의 자세한 구현 코드를 읽는다.  

<br><br>

### 이름 확인  
> 이름을 확인하는 것은 하위 문제를 해결할 코드를 찾기 위한 편리하고 빠른 방법이다.  
> 자신의 코드를 다른 개발자가 어떻게 사용해야 하는지에 대해 가장 잘 전달할 수 있는 방법 중 하나이다.  

<br><br>

### 데이터 유형 확인  
> 유형 시스템을 사용하는 언어로 코드를 작성하는 것은 다른 개발자가 코드를 오용하거나 오작동할 수 없도록 하기 위한 좋은 방법 중 하나이다.  

<br><br>


### 문서 읽기
함수 및 클래스 수준의 비공식적인 주석문, 자바독 같은 공식적인 코드 내 문서, 외부 문서 등이 있다.  
유용하게 사용될 수 있지만 100% 신뢰할 수 없다.  
다른 개발자가 읽지 않을 수 있고, 잘못 해석할 수 있고, 문서 업데이트가 제대로 안될 수 있다.  

<br><br>

## 3. 코드 계약  
> 계약에 의한 프로그래밍, 계약에 의한 디자인.  
> 서로 다른 코드 간의 **상호작용을 계약처럼 생각**할 수 있다.  
> 다른 사람들이 어떻게 코드를 사용할지, 코드가 무엇을 할 것으로 기대할 수 있는지에 대한 것이다.  

모든 것이 계약에서 정의되기 때문에 분명하지 않은 것이 없고 예상과 다르게 실행되는 것도 없다.  

코드 계약의 용어를 3개의 범주로 나눌 수 있다.  
* **선결 조건(precondition)**: 코드를 호출하기 전에 사실이어야 하는 것  
* **사후 조건(postcondition)**: 코드가 호출된 후에 사실이어야 하는 것  
* **불변 사항(invariant)**: 코드가 호출되기 전과 후에 시스템 상태를 비교해서 변경되지 않아야 하는 사항  


개발자가 계약의 일부 혹은 모든 조건을 알지 못하면 코드 계약에 문제가 발생한다.  
코드를 작성할 때, 만들어지는 계약의 내용이 무엇일지 그리고 어떻게 하면 코드를 사용하는 사람이 계약을 파악하고 따라갈 수 있을지에 대해 생각하는 것이 중요하다.  

<br><br>

### 계약의 세부 조항  
> 명확한 부분: 함수와 클래스 이름, 인자 유형, 반환 유형, 검사 예외(checked exception)  
> 세부 조항: 주석문과 문서, 비검사 예외(unchecked exception)  

코드 계약에서 조건을 명백하게 하는 것이 세부 조항을 사용하는 것보다 훨씬 낫다.  

<br><br>

### 세부 조항에 너무 의존하지 말라  
> 코드 계약을 전달할 때 **세부 조항을 사용하는 것은 신뢰할 만한 방법이 아니다**.  
> 세부 조항에 너무 많이 의존하면 오용하기 쉬운 취약한 코드가 될 가능성이 크고, 예상과 다르게 동작하기 쉽다.  
> 코드에 숨겨진 세부 조항이 많을수록 오류가 손쉽게 발생할 수 있는 방법이 많다.  


명확하지 않을 수도 있는 사항들을 문서화하는 것은 일반적으로 좋은 생각이지만 너무 많이 의존하지 않는 것이 최선의 방법이다.  
코드 계약의 분명한 항목을 통해 코드에 관해 명확하게 설명하는 것이 가능하다면 그렇게 하는 것이 더 바람직할 때가 많다.  

<br><br>

#### 세부 조항을 제거하는 방법 
다른 개발자가 코드를 올바르게 사용하기 위해 세부 조항에 의존하기보다 잘못된 일을 하는 것을 처음부터 불가능하게 만드는 것이 좋다.  
코드 계약의 세부 조항에 있는 어떤 항목에 대해 발생 자체가 불가능하도록 명백한 항목으로 바꾸는 것이 가능한 경우가 있다.  

코드가 오용되거나 잘못 설정되면 컴파일조차 되지 않도록 하는 것을 목표로 한다.  
코드를 오용하는 것이 불가능하면 다른 개발자들이 그 코드를 사용할 때 버그가 침투할 가능성이 훨씬 낮아진다.  

<br><br>

#### 상태와 가변성  
코드 품질을 향상하기 위한 많은 방법은 `상태(state)`와 `가변성(mutability)`을 최소화하는 것과 관련 있다.  
객체의 상태를 수정할 수 있으면 `가변적(mutable)`이라 하고, 상태를 변경할 수 없다면 `불변적(immutable)`이라고 한다.  

<br><br>

## 4. 체크 및 어서션  
> 코드 계약을 확인하는 대안으로 `런타임 검사`를 사용할 수 있다.  
> 해당 방법은 일반적으로 컴파일 타임 확인만큼 강력하지 않다.  
> 그 이유는 코드 계약 위반의 발견이 코드를 실행하는 동안 발생하는 문제에 대한 테스트에 의존하기 때문이다.  

<br><br>

### 체크  
> 코드 계약 조건을 확인하기 위한 일반적인 방법은 `체크`를 이용하는 것이다.  
> 코드 계약이 준수되었는지 확인하기 위한 추가적인 로직이며, 준수되지 않은 경우 체크는 실패를 유발하는 오류를 생성한다.  


체크는 시행 중인 계약 조건에 따라 아래와 같은 범주로 구분된다.  
* 전제 조건 검사: 입력 인수, 초기화 상태, 코드 실행 전 시스템의 유효 상태 확인  
* 사후 상태 검사: 반환값, 코드 실행 후 시스템의 유효 상태 확인  

<br><br>

체크를 사용하는 것이 명백하게 파악되지 않는 상황보다는 낫지만 **체크의 효과가 보장되는 것은 아니다**.  

경우에 따라 코드 계약에서 세부 조항을 피할 수 없으며, 이때는 계약이 준수되는지 확인하기 위해 체크를 추가하는 것이 좋다.  
**코드에 체크가 많이 있으면 세부 조항을 없애는 것에 대해 고려해봐야 한다는 신호일 수 있다.**  

<br><br>

### 어서션  
> `어서션(assertion)`은 코드 계약을 준수하도록 강제하기 위한 방법이다.  

* 어서션과 체크의 차이: 배포를 위해 빌드할 때 어서션은 보통 컴파일에서 제외된다.  

* 어서션이 컴파일에서 제외되는 이유  
  * 성능 향상을 위해: 코드에서 어서션이 많으면 소프트웨어의 전반적인 성능이 눈에 띄게 저하될 수 있다.  
  * 코드 오류 발생률을 낮추기 위해: 버그가 눈에 띄지 않을 가능성이 증가하지만 버그 발생 가능성 방지보다 고가용성이 더 중요한 시스템이라면 이는 적절한 절충안이 될 수 있다.  

<br><br>

체크에 대해 언급했던 사항은 어서션에도 해당된다.  
코드 계약에 세부 조항이 있을 때 어서션을 사용하면 좋다.  
하지만 세부 사항을 피하는 것이 가장 바람직하다.  
